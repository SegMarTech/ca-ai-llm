<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CA Sahab | Professional AI Assistant</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/themes/prism-tomorrow.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/prism.min.js"></script>

    <style>
        :root {
            --primary: #f6821f;
            --primary-soft: #fff7ed;
            --sidebar-bg: #111827;
            --bg-chat: #f9fafb;
            --border: #e5e7eb;
            --radius-lg: 16px;
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; background: #fff; display: flex; height: 100vh; overflow: hidden; }

        /* Sidebar */
        aside { width: 260px; background: var(--sidebar-bg); color: white; display: flex; flex-direction: column; padding: 1.25rem; }
        .new-chat { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 0.75rem; border-radius: 12px; cursor: pointer; display: flex; align-items: center; gap: 10px; margin-bottom: 2rem; }

        /* Main Chat Area */
        main { flex: 1; display: flex; flex-direction: column; background: var(--bg-chat); position: relative; }
        header { padding: 1rem 2rem; background: rgba(255,255,255,0.8); backdrop-filter: blur(10px); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        
        #chat-messages { flex: 1; overflow-y: auto; padding: 2rem 15%; display: flex; flex-direction: column; gap: 1.5rem; }

        /* Message Bubbles */
        .message { display: flex; gap: 1rem; max-width: 900px; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .avatar { width: 36px; height: 36px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.8rem; flex-shrink: 0; }
        .assistant-message .avatar { background: var(--primary); color: white; }
        .user-message { flex-direction: row-reverse; }
        .user-message .avatar { background: #374151; color: white; }

        .bubble { padding: 1rem 1.25rem; border-radius: var(--radius-lg); font-size: 0.95rem; line-height: 1.6; box-shadow: 0 1px 2px rgba(0,0,0,0.05); max-width: 80%; }
        .assistant-message .bubble { background: white; border: 1px solid var(--border); }
        .user-message .bubble { background: var(--primary); color: white; }

        /* Input Area */
        .input-container { padding: 1.5rem 15%; background: var(--bg-chat); }
        .input-wrapper { background: white; border: 1px solid var(--border); border-radius: var(--radius-lg); padding: 0.75rem 1rem; display: flex; align-items: flex-end; gap: 10px; box-shadow: var(--shadow-md); }
        textarea { flex: 1; border: none; outline: none; padding: 0.5rem 0; font-family: inherit; font-size: 1rem; resize: none; max-height: 200px; }
        
        .icon-btn { background: none; border: none; color: #6b7280; cursor: pointer; padding: 5px; border-radius: 6px; }
        .send-btn { background: var(--primary) !important; color: white !important; width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; }

        .sources-panel { background: #f3f4f6; padding: 10px; border-radius: 8px; margin-top: 10px; font-size: 0.8rem; }
        
        @media (max-width: 800px) { aside { display: none; } #chat-messages, .input-container { padding: 1rem; } }
    </style>
</head>
<body>

    <aside>
        <button class="new-chat"><i data-lucide="plus"></i> New Chat</button>
        <div style="font-size: 0.75rem; color: #6b7280; text-transform: uppercase; margin-bottom: 10px;">History</div>
        <div style="font-size: 0.85rem; color: #9ca3af;">No recent chats</div>
    </aside>

    <main>
        <header>
            <div>
                <h1 style="font-size: 1.1rem; font-weight: 700;">CA Sahab</h1>
                <p style="font-size: 0.7rem; color: #6b7280;">Income Tax & Audit Expert</p>
            </div>
            <select id="domain-selector" style="padding: 5px 10px; border-radius: 8px; border: 1px solid var(--border);">
                <option>Direct Tax</option>
                <option>GST</option>
                <option>Audit</option>
            </select>
        </header>

        <div id="chat-messages">
            <div class="message assistant-message">
                <div class="avatar">AI</div>
                <div class="bubble">Hello! I am your CA Assistant. You can ask me about tax laws, balance sheet analysis, or audit procedures.</div>
            </div>
        </div>

        <div class="input-container">
            <div class="input-wrapper">
                <button class="icon-btn" onclick="document.getElementById('file-input').click()"><i data-lucide="paperclip"></i></button>
                <input type="file" id="file-input" style="display:none">
                <textarea id="user-input" placeholder="Type your query here..." rows="1"></textarea>
                <button class="icon-btn send-btn" id="send-button"><i data-lucide="send-horizontal"></i></button>
            </div>
            <p style="text-align:center; font-size: 0.7rem; color: #9ca3af; margin-top: 10px;">Professional Guidance Only â€¢ Updated for FY 2024-25</p>
        </div>
    </main>

    <script>
        // Initialize Icons
        lucide.createIcons();

        const chatMessages = document.getElementById('chat-messages');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');

        // Auto-resize textarea
        userInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });

        // Send Message Logic
        async function handleSend() {
            const text = userInput.value.trim();
            if (!text) return;

            // 1. Add User Message to UI
            appendMessage('user', text);
            userInput.value = '';
            userInput.style.height = 'auto';

            // 2. Add Assistant Loading State
            const { contentDiv, container } = createAssistantPlaceholder();
            
            // --- SIMULATION MODE ---
            // Remove this block when you have a real backend API
            setTimeout(() => {
                const responseText = "### Analysis Complete\nBased on the data provided, the **Current Ratio** is healthy. However, you should check the **Section 43B(h)** compliance for MSME payments.\n\n*Would you like me to generate a checklist?*";
                contentDiv.innerHTML = marked.parse(responseText);
                addMessageActions(container, responseText);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 1000);
            // -----------------------
        }

        function appendMessage(role, text) {
            const msgDiv = document.createElement('div');
            msgDiv.className = `message ${role}-message`;
            msgDiv.innerHTML = `
                <div class="avatar">${role === 'user' ? 'U' : 'AI'}</div>
                <div class="bubble">${marked.parse(text)}</div>
            `;
            chatMessages.appendChild(msgDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function createAssistantPlaceholder() {
            const msgDiv = document.createElement('div');
            msgDiv.className = 'message assistant-message';
            msgDiv.innerHTML = `
                <div class="avatar">AI</div>
                <div class="bubble">
                    <div class="content">Thinking...</div>
                    <div class="meta" style="margin-top:10px; display:flex; gap:10px;"></div>
                </div>
            `;
            chatMessages.appendChild(msgDiv);
            return { 
                contentDiv: msgDiv.querySelector('.content'),
                container: msgDiv.querySelector('.bubble')
            };
        }

        function addMessageActions(container, text) {
            const meta = container.querySelector('.meta');
            meta.innerHTML = `
                <button class="icon-btn" style="font-size:0.7rem; display:flex; align-items:center; gap:4px;" onclick="navigator.clipboard.writeText(\`${text}\`)">
                    <i data-lucide="copy" style="width:12px"></i> Copy
                </button>
            `;
            lucide.createIcons();
        }

        sendButton.onclick = handleSend;
        userInput.onkeydown = (e) => { if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSend(); } };
    </script>
</body>
</html>
